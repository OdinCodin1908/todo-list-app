<script>
    // Get DOM elements
    const taskInput = document.getElementById('taskInput');
    const addButton = document.getElementById('addButton');
    const taskList = document.getElementById('taskList');
    const emptyState = document.getElementById('emptyState');
    const clearAllButton = document.getElementById('clearAll'); // ADDED THIS LINE

    // Initialize tasks from local storage
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];

    // Add task function
    function addTask() {
        const taskText = taskInput.value.trim();
        
        if (taskText === '') {
            alert('Please enter a task!');
            return;
        }

        // Create new task object
        const newTask = {
            id: Date.now(), // Unique ID based on timestamp
            text: taskText,
            completed: false,
            createdAt: new Date().toISOString()
        };

        // Add to tasks array
        tasks.push(newTask);

        // Save to local storage and update UI
        saveTasks();
        renderTasks();

        // Clear input
        taskInput.value = '';
        taskInput.focus();
    }

    // Delete task function
    function deleteTask(taskId) {
        tasks = tasks.filter(task => task.id !== taskId);
        saveTasks();
        renderTasks();
    }

    // Toggle task completion
    function toggleTaskCompletion(taskId) {
        tasks = tasks.map(task => {
            if (task.id === taskId) {
                return { ...task, completed: !task.completed };
            }
            return task;
        });
        saveTasks();
        renderTasks();
    }

    // Save tasks to local storage
    function saveTasks() {
        localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    // Render all tasks
    function renderTasks() {
        taskList.innerHTML = '';

        if (tasks.length === 0) {
            updateEmptyState();
            return;
        }

        tasks.forEach(task => {
            const taskItem = document.createElement('li');
            taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
            taskItem.setAttribute('data-task-id', task.id);
            
            // Format creation date
            const createdDate = new Date(task.createdAt);
            const dateString = createdDate.toLocaleDateString();
            
            taskItem.innerHTML = `
                <div class="task-content">
                    <span class="task-text">${task.text}</span>
                    <small class="task-date">Added: ${dateString}</small>
                </div>
                <div class="task-actions">
                    <button class="complete-btn" title="${task.completed ? 'Mark incomplete' : 'Mark complete'}">
                        ${task.completed ? '↶' : '✓'}
                    </button>
                    <button class="delete-btn" title="Delete task">✕</button>
                </div>
            `;

            // Add event listeners
            const completeBtn = taskItem.querySelector('.complete-btn');
            const deleteBtn = taskItem.querySelector('.delete-btn');

            completeBtn.addEventListener('click', () => toggleTaskCompletion(task.id));
            deleteBtn.addEventListener('click', () => deleteTask(task.id));

            taskList.appendChild(taskItem);
        });

        updateEmptyState();
    }

    // Update empty state visibility
    function updateEmptyState() {
        if (tasks.length === 0) {
            emptyState.classList.remove('hidden');
            clearAllButton.disabled = true; // ADDED THIS LINE
        } else {
            emptyState.classList.add('hidden');
            clearAllButton.disabled = false;
        }
    }

    // Clear ALL tasks function
    function clearAllTasks() {
        if (tasks.length === 0) {
            alert('No tasks to clear!');
            return;
        }
    
        if (confirm('Are you sure you want to delete ALL tasks? This cannot be undone!')) {
            tasks = [];
            saveTasks();
            renderTasks();
        }
    }

    // Initialize the app when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Set up event listeners
        clearAllButton.addEventListener('click', clearAllTasks);
        addButton.addEventListener('click', addTask);
        
        taskInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        // Load and render existing tasks
        renderTasks();
    });
</script>
